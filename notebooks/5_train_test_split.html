<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Train test split – Urban morphometrics | EuroFab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ad12125f43b1cd0365d2f9404fbc2628.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&amp;display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks/1_download_ms_data.html">Notebooks</a></li><li class="breadcrumb-item"><a href="../notebooks/5_train_test_split.html">Train test split</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Urban morphometrics | EuroFab</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/eurofab-project/morphometrics" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">About</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://eurofab-project.github.io/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project homepage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://eurofab-project.github.io/talks/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Talks</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Other work streams</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://eurofab-project.github.io/eo/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Earth observation</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Notebooks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/1_download_ms_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download MS-based data - buildings and streets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/1_download_ov_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download Overture-based data buildigns and streets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/2_process_regions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Morphometic processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/3_assign_targets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assign target labels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/4_assign_buildings_to_h3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assign ETCs to hexagons</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/5_train_test_split.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Train test split</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/6_single_model_training.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Eurofab model training</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/7_figures_and_tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generate figures and tables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/interactive_exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualize data on an interactive map</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#plot-testing-regions" id="toc-plot-testing-regions" class="nav-link active" data-scroll-target="#plot-testing-regions">Plot testing regions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks/1_download_ms_data.html">Notebooks</a></li><li class="breadcrumb-item"><a href="../notebooks/5_train_test_split.html">Train test split</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Train test split</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Split the data into multiple train / test sets, so that the prediction accuracy of the model can be assest against every country.</p>
<div id="9bc49b2a-60a7-4be5-bf50-c60f27f4b182" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d20e1f73-dd86-4c88-8cb5-331262db929f" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>country_names <span class="op">=</span> [<span class="st">'Germany'</span>, <span class="st">'Poland'</span>, <span class="st">'Czechia'</span>, <span class="st">'Slovakia'</span>, <span class="st">'Austria'</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>TRAINING1, TESTING1 <span class="op">=</span> [<span class="st">'Poland'</span>, <span class="st">'Germany'</span>, <span class="st">'Austria'</span>, <span class="st">'Czechia'</span>], [<span class="st">'Slovakia'</span>]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>TRAINING2, TESTING2 <span class="op">=</span> [<span class="st">'Slovakia'</span>, <span class="st">'Germany'</span>, <span class="st">'Austria'</span>, <span class="st">'Czechia'</span>], [<span class="st">'Poland'</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>TRAINING3, TESTING3 <span class="op">=</span> [<span class="st">'Poland'</span>, <span class="st">'Slovakia'</span>, <span class="st">'Austria'</span>, <span class="st">'Czechia'</span>], [<span class="st">'Germany'</span>]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>TRAINING4, TESTING4 <span class="op">=</span> [<span class="st">'Poland'</span>, <span class="st">'Germany'</span>, <span class="st">'Slovakia'</span>, <span class="st">'Czechia'</span>], [<span class="st">'Austria'</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>TRAINING5, TESTING5 <span class="op">=</span> [<span class="st">'Poland'</span>, <span class="st">'Germany'</span>, <span class="st">'Austria'</span>, <span class="st">'Slovakia'</span>], [<span class="st">'Czechia'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="3c639c49-b721-4524-8f67-d770c93279a1" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>coredir <span class="op">=</span> <span class="st">'/data/uscuni-eurofab-overture/'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="39914ee7-675e-4c20-a3ac-2ace6703bcba" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>regions_datadir <span class="op">=</span> coredir</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>tessellations_dir <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/tessellations/'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>buildings_dir <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/buildings/'</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/chars/'</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>target_dir <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/target_clusters/'</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>hex_dir <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/hexagons/'</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> coredir <span class="op">==</span> <span class="st">'/data/uscuni-eurofab/'</span>:</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    region_hulls <span class="op">=</span> gpd.read_parquet(</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            regions_datadir <span class="op">+</span> <span class="st">"regions/"</span> <span class="op">+</span> <span class="st">"ms_ce_region_hulls.parquet"</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    region_hulls <span class="op">=</span> gpd.read_parquet(</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            regions_datadir <span class="op">+</span> <span class="st">"regions/"</span> <span class="op">+</span> <span class="st">"ov_ce_region_hulls.parquet"</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> <span class="st">'gaussian'</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>spatial_lag <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>bandwith_type<span class="op">=-</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b49dc96b-ffcc-46d7-a830-c1355fcf1568" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>char_type <span class="op">=</span> <span class="st">'only_unweighted_lag_overture'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Download a shapefile of all EU countries, if not present.</p>
<div id="8c7ae7ec-86ce-452c-ad98-05d25fa7d94f" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download countries</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># !wget https://gisco-services.ec.europa.eu/distribution/v2/countries/geojson/CNTR_RG_01M_2024_3035.geojson</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assign regions to countries</p>
<div id="8662a286-5f22-429a-b2e8-5cb747cfc217" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> gpd.read_file(<span class="st">'CNTR_RG_01M_2024_3035.geojson'</span>).to_crs(epsg<span class="op">=</span><span class="dv">3035</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>country_polygons <span class="op">=</span> countries[countries[<span class="st">'NAME_ENGL'</span>].isin(country_names)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="950eff11-ea6b-402f-b4e7-e9714d5303b1" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>region_idxs, country_idxs <span class="op">=</span> country_polygons.sindex.query(region_hulls.geometry, predicate<span class="op">=</span><span class="st">'intersects'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>intersections <span class="op">=</span> region_hulls.iloc[region_idxs].intersection(country_polygons.iloc[country_idxs], align<span class="op">=</span><span class="va">False</span>).area</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="79640b4d-c79c-444a-871d-1619f4bbd89c" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>country_polygons</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CNTR_ID</th>
<th data-quarto-table-cell-role="th">CNTR_NAME</th>
<th data-quarto-table-cell-role="th">NAME_ENGL</th>
<th data-quarto-table-cell-role="th">NAME_FREN</th>
<th data-quarto-table-cell-role="th">ISO3_CODE</th>
<th data-quarto-table-cell-role="th">SVRG_UN</th>
<th data-quarto-table-cell-role="th">CAPT</th>
<th data-quarto-table-cell-role="th">EU_STAT</th>
<th data-quarto-table-cell-role="th">EFTA_STAT</th>
<th data-quarto-table-cell-role="th">CC_STAT</th>
<th data-quarto-table-cell-role="th">NAME_GERM</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>AT</td>
<td>Österreich</td>
<td>Austria</td>
<td>Autriche</td>
<td>AUT</td>
<td>UN Member State</td>
<td>Vienna</td>
<td>T</td>
<td>F</td>
<td>F</td>
<td>Österreich</td>
<td>MULTIPOLYGON (((4354847.685 2714710.627, 43552...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>CZ</td>
<td>Česká Republika</td>
<td>Czechia</td>
<td>Tchéquie</td>
<td>CZE</td>
<td>UN Member State</td>
<td>Prague</td>
<td>T</td>
<td>F</td>
<td>F</td>
<td>Tschechien</td>
<td>MULTIPOLYGON (((4624842.426 3112217.365, 46255...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>DE</td>
<td>Deutschland</td>
<td>Germany</td>
<td>Allemagne</td>
<td>DEU</td>
<td>UN Member State</td>
<td>Berlin</td>
<td>T</td>
<td>F</td>
<td>F</td>
<td>Deutschland</td>
<td>MULTIPOLYGON (((4355225.354 2715902.995, 43548...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">169</td>
<td>PL</td>
<td>Polska</td>
<td>Poland</td>
<td>Pologne</td>
<td>POL</td>
<td>UN Member State</td>
<td>Warsaw</td>
<td>T</td>
<td>F</td>
<td>F</td>
<td>Polen</td>
<td>MULTIPOLYGON (((4852825.195 3556096.333, 48551...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">191</td>
<td>SK</td>
<td>Slovensko</td>
<td>Slovakia</td>
<td>Slovaquie</td>
<td>SVK</td>
<td>UN Member State</td>
<td>Bratislava</td>
<td>T</td>
<td>F</td>
<td>F</td>
<td>Slowakei</td>
<td>MULTIPOLYGON (((5003133.924 2988592.038, 50037...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="2d5461bf-c793-4fc9-8b80-7faf7dea48bc" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>intersection_df <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'region_id'</span>: region_hulls.index[region_idxs].values,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'country'</span>: country_polygons.iloc[country_idxs, <span class="dv">2</span>].values,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'intersection_area'</span>: intersections.values,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'geometry'</span>: region_hulls.iloc[region_idxs, <span class="dv">0</span>].values</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span>region_hulls.crs</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                                   </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                                  </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>intersection_df <span class="op">=</span> intersection_df.sort_values(<span class="st">'intersection_area'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>intersection_df <span class="op">=</span> intersection_df[<span class="op">~</span>intersection_df.region_id.duplicated()].sort_values(<span class="st">'region_id'</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (intersection_df.region_id <span class="op">==</span> region_hulls.index).<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="09a67008-b1ba-4e89-b0b7-cbe3fc691eba" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> combine_regions_data(selected_regions, char_type<span class="op">=</span><span class="st">'primary'</span>):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Combine the morphometric data, target labels and hexagons from all of the 'selected_regions' into a single dataframe for model training."""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    all_data <span class="op">=</span> []</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    all_labels <span class="op">=</span> []</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    all_hexagons <span class="op">=</span> []</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trid <span class="kw">in</span> selected_regions:</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> char_type <span class="op">==</span> <span class="st">'weighted_lag'</span>:</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> pd.read_parquet(<span class="ss">f'/data/uscuni-eurofab/processed_data/chars/lag_chars_</span><span class="sc">{</span>trid<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>kernel<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>spatial_lag<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>bandwith_type<span class="sc">}</span><span class="ss">.parquet'</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> data.astype(np.float32)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            data.index <span class="op">=</span> data.index.astype(np.int32)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> char_type <span class="op">==</span> <span class="st">'unweighted_lag'</span>:</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> pd.read_parquet(<span class="ss">f'/data/uscuni-eurofab/processed_data/chars/lag_chars_</span><span class="sc">{</span>trid<span class="sc">}</span><span class="ss">_unweighted_</span><span class="sc">{</span>spatial_lag<span class="sc">}</span><span class="ss">.parquet'</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> data.astype(np.float32)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            data.index <span class="op">=</span> data.index.astype(np.int32)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> char_type <span class="op">==</span> <span class="st">'primary'</span>:</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> pd.read_parquet(<span class="ss">f'</span><span class="sc">{</span>data_dir<span class="sc">}</span><span class="ss">primary_chars_</span><span class="sc">{</span>trid<span class="sc">}</span><span class="ss">.parquet'</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> char_type <span class="op">==</span> <span class="st">'only_unweighted_lag'</span>:</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> pd.read_parquet(<span class="ss">f'/data/uscuni-eurofab/processed_data/chars/lag_chars_</span><span class="sc">{</span>trid<span class="sc">}</span><span class="ss">_unweighted_</span><span class="sc">{</span>spatial_lag<span class="sc">}</span><span class="ss">.parquet'</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> data.astype(np.float32)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>            data.index <span class="op">=</span> data.index.astype(np.int32)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>            iqr <span class="op">=</span> pd.DataFrame(data.loc[:, data.columns.<span class="bu">str</span>.contains(<span class="st">'_85'</span>)].values <span class="op">-</span> data.loc[:, data.columns.<span class="bu">str</span>.contains(<span class="st">'_15'</span>)].values, </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>                         index<span class="op">=</span>data.index, </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>                         columns<span class="op">=</span>data.columns[<span class="op">~</span>data.columns.<span class="bu">str</span>.contains(<span class="st">'_'</span>)] <span class="op">+</span> <span class="st">'_iqr'</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>            median <span class="op">=</span> data.loc[:, data.columns.<span class="bu">str</span>.contains(<span class="st">'_median'</span>)]</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> pd.merge(iqr, median, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> char_type <span class="op">==</span> <span class="st">'primary_overture'</span>:</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>            <span class="co"># same as primary data, but add a data source column from the building parquet</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> pd.read_parquet(<span class="ss">f'</span><span class="sc">{</span>data_dir<span class="sc">}</span><span class="ss">primary_chars_</span><span class="sc">{</span>trid<span class="sc">}</span><span class="ss">.parquet'</span>)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>            data_source <span class="op">=</span> pd.read_parquet(<span class="ss">f"</span><span class="sc">{</span>data_dir<span class="sc">}</span><span class="ss">buildings_chars_</span><span class="sc">{</span>trid<span class="sc">}</span><span class="ss">.parquet"</span>, columns<span class="op">=</span>[<span class="st">'source'</span>, <span class="st">'class'</span>])</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">'source'</span>] <span class="op">=</span> data_source[<span class="st">'source'</span>]</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> char_type <span class="op">==</span> <span class="st">'unweighted_lag_overture'</span>:</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># same as unweighted lag, but add a data source column from the building parquet and only save the median</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> pd.read_parquet(<span class="ss">f'/data/uscuni-eurofab-overture/processed_data/chars/lag_chars_</span><span class="sc">{</span>trid<span class="sc">}</span><span class="ss">_unweighted_</span><span class="sc">{</span>spatial_lag<span class="sc">}</span><span class="ss">.parquet'</span>)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> data.astype(np.float32)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>            data.index <span class="op">=</span> data.index.astype(np.int32)</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>            data_source <span class="op">=</span> pd.read_parquet(<span class="ss">f"</span><span class="sc">{</span>data_dir<span class="sc">}</span><span class="ss">buildings_chars_</span><span class="sc">{</span>trid<span class="sc">}</span><span class="ss">.parquet"</span>, columns<span class="op">=</span>[<span class="st">'source'</span>, <span class="st">'class'</span>])</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>            data[<span class="st">'source'</span>] <span class="op">=</span> data_source[<span class="st">'source'</span>]</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> data.loc[:, <span class="op">~</span>data.columns.<span class="bu">str</span>.contains(<span class="st">'_'</span>) <span class="op">|</span> data.columns.<span class="bu">str</span>.contains(<span class="st">'_median'</span>)]</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> char_type <span class="op">==</span> <span class="st">'only_unweighted_lag_overture'</span>:</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># keep only median and iqr from the lag, no primary chars</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> pd.read_parquet(<span class="ss">f'/data/uscuni-eurofab-overture/processed_data/chars/lag_chars_</span><span class="sc">{</span>trid<span class="sc">}</span><span class="ss">_unweighted_</span><span class="sc">{</span>spatial_lag<span class="sc">}</span><span class="ss">.parquet'</span>)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> data.astype(np.float32)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>            data.index <span class="op">=</span> data.index.astype(np.int32)</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>            iqr <span class="op">=</span> pd.DataFrame(data.loc[:, data.columns.<span class="bu">str</span>.contains(<span class="st">'_85'</span>)].values <span class="op">-</span> data.loc[:, data.columns.<span class="bu">str</span>.contains(<span class="st">'_15'</span>)].values, </span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>                         index<span class="op">=</span>data.index, </span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>                         columns<span class="op">=</span>data.columns[<span class="op">~</span>data.columns.<span class="bu">str</span>.contains(<span class="st">'_'</span>)] <span class="op">+</span> <span class="st">'_iqr'</span>)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>            median <span class="op">=</span> data.loc[:, data.columns.<span class="bu">str</span>.contains(<span class="st">'_median'</span>)]</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> pd.merge(iqr, median, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">'Datatype does not exist'</span>)</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>        targets <span class="op">=</span> pd.read_parquet(<span class="ss">f'</span><span class="sc">{</span>target_dir<span class="sc">}{</span>trid<span class="sc">}</span><span class="ss">_target.pq'</span>).set_index(<span class="st">'index'</span>)</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>        hexagons <span class="op">=</span> pd.read_parquet(<span class="ss">f'</span><span class="sc">{</span>hex_dir<span class="sc">}{</span>trid<span class="sc">}</span><span class="ss">_hexagon.pq'</span>).set_index(<span class="st">'index'</span>)</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># drop empty tess to save some memory</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>        targets <span class="op">=</span> targets[targets.index <span class="op">&gt;</span> <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>        common_index <span class="op">=</span> data.index.join(targets.index, how<span class="op">=</span><span class="st">'inner'</span>).join(hexagons.index, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> data.loc[common_index]</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>        targets <span class="op">=</span> targets.loc[common_index]</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>        hexagons <span class="op">=</span> hexagons.loc[common_index]</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># record region_id in the index</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>        common_index <span class="op">=</span> <span class="bu">str</span>(trid) <span class="op">+</span> <span class="st">'_'</span> <span class="op">+</span> common_index.astype(<span class="bu">str</span>)</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> data.set_index(common_index)</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>        targets <span class="op">=</span> targets.set_index(common_index)</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>        hexagons <span class="op">=</span> hexagons.set_index(common_index)</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>        all_data.append(data)</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>        all_labels.append(targets)</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>        all_hexagons.append(hexagons)</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>    all_data <span class="op">=</span> pd.concat(all_data)</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>    all_labels <span class="op">=</span> pd.concat(all_labels)</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>    all_hexagons <span class="op">=</span> pd.concat(all_hexagons)</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> all_data, all_labels, all_hexagons</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Generate the final country level train/test datasets.</p>
<div id="4cb169ba-0833-4d63-b5b5-7debf4c07d3b" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>training_countries <span class="op">=</span> TRAINING1</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>testing_countries <span class="op">=</span> TESTING1</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>training_regions <span class="op">=</span> intersection_df[intersection_df[<span class="st">'country'</span>].isin(training_countries)].region_id.values</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>testing_regions <span class="op">=</span> intersection_df[intersection_df[<span class="st">'country'</span>].isin(testing_countries)].region_id.values</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>all_data, all_labels, all_hexagons <span class="op">=</span> combine_regions_data(training_regions, char_type<span class="op">=</span>char_type)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>all_data.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_data1.pq'</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>all_labels.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_labels1.pq'</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>all_hexagons.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_hexagons1.pq'</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>all_data, all_labels, all_hexagons <span class="op">=</span> combine_regions_data(testing_regions, char_type<span class="op">=</span>char_type)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>all_data.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_data1.pq'</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>all_labels.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_labels1.pq'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 8min 10s, sys: 4min 31s, total: 12min 42s
Wall time: 3min 49s</code></pre>
</div>
</div>
<div id="7cda9194-033e-420c-8fe7-857815cd96e1" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>training_countries <span class="op">=</span> TRAINING2</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>testing_countries <span class="op">=</span> TESTING2</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>training_regions <span class="op">=</span> intersection_df[intersection_df[<span class="st">'country'</span>].isin(training_countries)].region_id.values</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>testing_regions <span class="op">=</span> intersection_df[intersection_df[<span class="st">'country'</span>].isin(testing_countries)].region_id.values</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>all_data, all_labels, all_hexagons <span class="op">=</span> combine_regions_data(training_regions, char_type<span class="op">=</span>char_type)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>all_data.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_data</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>all_labels.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_labels</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>all_hexagons.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_hexagons</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>all_data, all_labels, all_hexagons <span class="op">=</span> combine_regions_data(testing_regions, char_type<span class="op">=</span>char_type)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>all_data.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_data</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>all_labels.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_labels</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 7min 57s, sys: 4min 35s, total: 12min 32s
Wall time: 3min 49s</code></pre>
</div>
</div>
<div id="5f097cd1-093f-446f-aef8-0e33c641fc52" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>training_countries <span class="op">=</span> TRAINING3</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>testing_countries <span class="op">=</span> TESTING3</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>training_regions <span class="op">=</span> intersection_df[intersection_df[<span class="st">'country'</span>].isin(training_countries)].region_id.values</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>testing_regions <span class="op">=</span> intersection_df[intersection_df[<span class="st">'country'</span>].isin(testing_countries)].region_id.values</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>all_data, all_labels, all_hexagons <span class="op">=</span> combine_regions_data(training_regions, char_type<span class="op">=</span>char_type)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>all_data.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_data</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>all_labels.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_labels</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>all_hexagons.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_hexagons</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>all_data, all_labels, all_hexagons <span class="op">=</span> combine_regions_data(testing_regions, char_type<span class="op">=</span>char_type)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>all_data.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_data</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>all_labels.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_labels</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 7min 55s, sys: 4min 3s, total: 11min 58s
Wall time: 3min 34s</code></pre>
</div>
</div>
<div id="90e1275d-9b25-421d-a8b4-8d5c410155ca" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>training_countries <span class="op">=</span> TRAINING4</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>testing_countries <span class="op">=</span> TESTING4</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>training_regions <span class="op">=</span> intersection_df[intersection_df[<span class="st">'country'</span>].isin(training_countries)].region_id.values</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>testing_regions <span class="op">=</span> intersection_df[intersection_df[<span class="st">'country'</span>].isin(testing_countries)].region_id.values</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>all_data, all_labels, all_hexagons <span class="op">=</span> combine_regions_data(training_regions, char_type<span class="op">=</span>char_type)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>all_data.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_data</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>all_labels.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_labels</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>all_hexagons.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_hexagons</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>all_data, all_labels, all_hexagons <span class="op">=</span> combine_regions_data(testing_regions, char_type<span class="op">=</span>char_type)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>all_data.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_data</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>all_labels.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_labels</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 8min 2s, sys: 4min 21s, total: 12min 23s
Wall time: 3min 57s</code></pre>
</div>
</div>
<div id="af8d9a83-3c1c-4c8e-bced-1cc341e6c706" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>training_countries <span class="op">=</span> TRAINING5</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>testing_countries <span class="op">=</span> TESTING5</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>training_regions <span class="op">=</span> intersection_df[intersection_df[<span class="st">'country'</span>].isin(training_countries)].region_id.values</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>testing_regions <span class="op">=</span> intersection_df[intersection_df[<span class="st">'country'</span>].isin(testing_countries)].region_id.values</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>all_data, all_labels, all_hexagons <span class="op">=</span> combine_regions_data(training_regions, char_type<span class="op">=</span>char_type)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>all_data.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_data</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>all_labels.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_labels</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>all_hexagons.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_hexagons</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>all_data, all_labels, all_hexagons <span class="op">=</span> combine_regions_data(testing_regions, char_type<span class="op">=</span>char_type)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>all_data.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_data</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>all_labels.to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_labels</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 8min 4s, sys: 4min 19s, total: 12min 23s
Wall time: 3min 51s</code></pre>
</div>
</div>
<div id="e4c9bbce-bd20-422a-9c6d-c9109f304916" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 is the insample model without spatial grouping (hexagons)</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>all_data, all_labels, all_hexagons <span class="op">=</span> combine_regions_data(region_hulls.index.values, char_type<span class="op">=</span>char_type)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedKFold</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>gkf <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>splits <span class="op">=</span> gkf.split(</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    all_data,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>all_labels.final_without_noise,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>split_label <span class="op">=</span> np.empty(<span class="bu">len</span>(all_data), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (train, test) <span class="kw">in</span> <span class="bu">enumerate</span>(splits):</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    split_label[test] <span class="op">=</span> i</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># assign four of the groups as training data</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> split_label <span class="op">!=</span> <span class="dv">0</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>all_data.loc[train].to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_data</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>all_labels.loc[train].to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_labels</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>all_hexagons.loc[train].to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_hexagons</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co"># assign one of the groups as test data</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> split_label <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>all_data.loc[test].to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_data</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>all_labels.loc[test].to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_labels</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 11min 53s, sys: 7min 9s, total: 19min 3s
Wall time: 6min 55s</code></pre>
</div>
</div>
<div id="563a2c71-af0f-4050-8256-5c6aa942c941" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 7 is the insample model with spatial grouping (hexagons)</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>all_data, all_labels, all_hexagons <span class="op">=</span> combine_regions_data(region_hulls.index.values, char_type<span class="op">=</span>char_type)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedGroupKFold</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>gkf <span class="op">=</span> StratifiedGroupKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>splits <span class="op">=</span> gkf.split(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    all_data,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>all_labels.final_without_noise,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    groups<span class="op">=</span>all_hexagons.hexagons,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>split_label <span class="op">=</span> np.empty(<span class="bu">len</span>(all_data), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (train, test) <span class="kw">in</span> <span class="bu">enumerate</span>(splits):</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    split_label[test] <span class="op">=</span> i</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co"># assign four of the groups as training data</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> split_label <span class="op">!=</span> <span class="dv">0</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>all_data.loc[train].to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_data</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>all_labels.loc[train].to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_labels</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>all_hexagons.loc[train].to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/training_hexagons</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="co"># assign one of the groups as test data</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> split_label <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>all_data.loc[test].to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_data</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>all_labels.loc[test].to_parquet(<span class="ss">f'</span><span class="sc">{</span>coredir<span class="sc">}</span><span class="ss">processed_data/train_test_data/testing_labels</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.pq'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 13min 19s, sys: 6min 31s, total: 19min 51s
Wall time: 7min 56s</code></pre>
</div>
</div>
<section id="plot-testing-regions" class="level3">
<h3 class="anchored" data-anchor-id="plot-testing-regions">Plot testing regions</h3>
<div id="f9804655-76d1-4589-9b3e-e3f1ec7181da" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>training_countries <span class="op">=</span> TRAINING4</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>testing_countries <span class="op">=</span> TESTING4</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>training_regions <span class="op">=</span> intersection_df[intersection_df[<span class="st">'country'</span>].isin(training_countries)].region_id.values</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>testing_regions <span class="op">=</span> intersection_df[intersection_df[<span class="st">'country'</span>].isin(testing_countries)].region_id.values</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>region_hulls.loc[testing_regions].explore()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div style="width:100%;"><div style="position:relative;width:100%;height:0;padding-bottom:60%;"><span style="color:#565656">Make this Notebook Trusted to load map: File -&gt; Trust Notebook</span><iframe srcdoc="<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;></script>
    <script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;></script>
    <script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;></script>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/>
    
            <meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; />
            <style>
                #map_3f28325b95dbc0a1fa3b3088ffb3eb82 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
    
                    <style>
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
</head>
<body>
    
    
            <div class=&quot;folium-map&quot; id=&quot;map_3f28325b95dbc0a1fa3b3088ffb3eb82&quot; ></div>
        
</body>
<script>
    
    
            var map_3f28325b95dbc0a1fa3b3088ffb3eb82 = L.map(
                &quot;map_3f28325b95dbc0a1fa3b3088ffb3eb82&quot;,
                {
                    center: [47.62028606590362, 13.561555490934156],
                    crs: L.CRS.EPSG3857,
                    zoom: 10,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );
            L.control.scale().addTo(map_3f28325b95dbc0a1fa3b3088ffb3eb82);

            

        
    
            var tile_layer_1453c8ac3e4923fc15e46a974c13ffc4 = L.tileLayer(
                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {&quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 19, &quot;maxZoom&quot;: 19, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_1453c8ac3e4923fc15e46a974c13ffc4.addTo(map_3f28325b95dbc0a1fa3b3088ffb3eb82);
        
    
            map_3f28325b95dbc0a1fa3b3088ffb3eb82.fitBounds(
                [[46.38435024733196, 9.68826381130027], [48.85622188447528, 17.43484717056804]],
                {}
            );
        
    
        function geo_json_ce10b91d42aff75c5c193b17524c9fb1_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.5, &quot;weight&quot;: 2};
            }
        }
        function geo_json_ce10b91d42aff75c5c193b17524c9fb1_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_ce10b91d42aff75c5c193b17524c9fb1_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_ce10b91d42aff75c5c193b17524c9fb1_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_ce10b91d42aff75c5c193b17524c9fb1_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                            geo_json_ce10b91d42aff75c5c193b17524c9fb1.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_ce10b91d42aff75c5c193b17524c9fb1_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_ce10b91d42aff75c5c193b17524c9fb1 = L.geoJson(null, {
                onEachFeature: geo_json_ce10b91d42aff75c5c193b17524c9fb1_onEachFeature,
            
                style: geo_json_ce10b91d42aff75c5c193b17524c9fb1_styler,
                pointToLayer: geo_json_ce10b91d42aff75c5c193b17524c9fb1_pointToLayer,
        });

        function geo_json_ce10b91d42aff75c5c193b17524c9fb1_add (data) {
            geo_json_ce10b91d42aff75c5c193b17524c9fb1
                .addData(data);
        }
            geo_json_ce10b91d42aff75c5c193b17524c9fb1_add({&quot;bbox&quot;: [9.68826381130027, 46.38435024733196, 17.43484717056804, 48.85622188447528], &quot;features&quot;: [{&quot;bbox&quot;: [9.68826381130027, 46.848190698701835, 10.223027603362313, 47.195635737280824], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[10.125751925259948, 46.848190698701835], [10.057656978482605, 46.86715604963671], [9.908169610206063, 46.9265547493466], [9.68826381130027, 47.06569015010727], [9.840681620295658, 47.11913596161396], [10.100184934020588, 47.18042146404222], [10.171418962864053, 47.195635737280824], [10.191132166565906, 47.17759879871767], [10.223027603362313, 46.92906465449122], [10.214906459885206, 46.86785796448735], [10.125751925259948, 46.848190698701835]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;labels&quot;: 22417}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [10.177231486910383, 46.78661207214629, 12.753545057761858, 48.02630773501874], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[10.800782260991213, 46.78856759129529], [10.505621098271698, 46.84707990999172], [10.501700057609822, 46.84799858168173], [10.261077694183173, 46.92987978108143], [10.177231486910383, 46.9651620592385], [10.177237550428433, 46.96696266193962], [10.193598535883629, 47.13168339689592], [10.197678668368566, 47.165884364670305], [10.204324190645425, 47.18027538052551], [10.220180666727, 47.18924640010941], [11.813051851581912, 47.94583538616873], [12.40445362909302, 48.02630773501874], [12.40579306397092, 48.02627845362689], [12.511863380505151, 47.92037713386423], [12.742736643354666, 47.6339198104885], [12.753545057761858, 47.61203613242473], [12.741846020357924, 47.54209040342724], [12.736110713764456, 47.53412960088878], [12.71626382468105, 47.51031121498732], [12.686925033362844, 47.48222096521381], [12.621998215139323, 47.43157135468698], [12.481280348971094, 47.3439160011325], [12.037934504664037, 47.07037978224843], [11.88206287844214, 47.01736933848715], [11.031049531127566, 46.78661207214629], [10.800782260991213, 46.78856759129529]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;1&quot;, &quot;properties&quot;: {&quot;labels&quot;: 27765}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [12.063003249984186, 46.916519247002576, 13.602603442885533, 47.538559710654894], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[12.169761027398119, 46.916519247002576], [12.16848689261494, 46.91744545653932], [12.13180953318161, 46.98391944867843], [12.083297438064507, 47.11904562691309], [12.063003249984186, 47.27251372394001], [12.074459713667274, 47.2948064702157], [12.739001970376775, 47.538559710654894], [13.185148813294415, 47.534554234927356], [13.210347270864427, 47.533815694791954], [13.378585648832601, 47.526032887321655], [13.55562202226138, 47.5113967850308], [13.562521767035248, 47.49585659466066], [13.598429635366054, 47.3054789841571], [13.602603442885533, 47.270201874653786], [13.577521419814426, 47.23228784288482], [13.304255385042103, 47.08959440658032], [13.233230916710287, 47.07011546739038], [12.169761027398119, 46.916519247002576]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;2&quot;, &quot;properties&quot;: {&quot;labels&quot;: 47986}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [12.20148729256859, 46.59374553334812, 13.283829400788834, 47.10329907257224], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[13.132415498448939, 46.59374553334812], [12.981438404080338, 46.600742964563985], [12.94505366517156, 46.60354811304545], [12.84770373833124, 46.61337913406397], [12.58240492610541, 46.659717598825424], [12.478827457744273, 46.6792696069684], [12.410714605113775, 46.70423778572855], [12.408143838218319, 46.70519611467622], [12.386349373863542, 46.71468927273855], [12.285118726367664, 46.7925471777074], [12.20148729256859, 46.89065936866859], [12.201524863863837, 46.89155925619333], [12.20643564574893, 46.914875919522935], [12.316268261259399, 47.02515832281413], [12.340077143074662, 47.02824870617097], [12.624554979399933, 47.06225623995355], [13.066491656999084, 47.10109010340116], [13.115371918036393, 47.10329907257224], [13.15171431916278, 47.094140037635945], [13.235249327707239, 47.06014490785236], [13.253846286529848, 47.041568624303416], [13.259130178433091, 47.020687568406785], [13.283829400788834, 46.76314539992941], [13.136376744976591, 46.59453112106728], [13.132415498448939, 46.59374553334812]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;3&quot;, &quot;properties&quot;: {&quot;labels&quot;: 53816}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [12.754552329533885, 47.86628438511217, 13.023008705405275, 48.11614214941674], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[12.949033797168413, 47.86628438511217], [12.900199675285783, 47.87749106562409], [12.842995196342399, 47.90690091484321], [12.7564055539155, 48.087376513682194], [12.754552329533885, 48.10272801291328], [12.758869122192618, 48.10802176949986], [12.76304007368279, 48.110618127100686], [12.792749851375014, 48.113470181433684], [12.829170974018133, 48.11614214941674], [12.83180399364517, 48.11517417988853], [12.934716988828914, 48.05935868536964], [12.98641672128511, 48.025553196853274], [13.023008705405275, 47.98673516677887], [13.022902077925266, 47.98493720340457], [13.019806861048515, 47.95530733308442], [12.978821335484383, 47.87268346217723], [12.966596693516292, 47.86941277797865], [12.949033797168413, 47.86628438511217]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;4&quot;, &quot;properties&quot;: {&quot;labels&quot;: 54449}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [13.327184319943482, 47.63169568941772, 15.281707925525602, 48.820284031057795], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[13.895916226680317, 47.65474292288912], [13.623459610457186, 47.79653421757199], [13.352665709988152, 47.94475245420221], [13.34755450280213, 47.948510748740695], [13.341223320141628, 47.95410708299724], [13.338725762613983, 47.95688479518823], [13.327184319943482, 48.00586610664521], [13.327771579238783, 48.014853993571286], [13.599253854755325, 48.49532698277721], [13.602278833306519, 48.49973125123769], [13.606720395251626, 48.504989871799076], [13.608136480905818, 48.505844299058516], [13.680982048751547, 48.53857037632716], [14.210504262805838, 48.756632591635004], [14.228384129283022, 48.75865701244959], [14.921259821127306, 48.820284031057795], [14.922618670574026, 48.82022398566912], [15.055679826263171, 48.81336216781494], [15.247387027189955, 48.7675361159555], [15.281707925525602, 48.280906557553315], [14.999902961850143, 47.72519233707954], [14.988326420220561, 47.702279517198185], [14.964023225797684, 47.67183012027678], [14.820907924752825, 47.63947270403914], [14.772193774876207, 47.63169568941772], [13.895916226680317, 47.65474292288912]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;5&quot;, &quot;properties&quot;: {&quot;labels&quot;: 60257}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [13.069743861309572, 46.57399126631647, 13.972723397919705, 47.033142612491254], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[13.191260125971837, 46.57399126631647], [13.178560263807556, 46.57977463300141], [13.155864452956065, 46.593059497179766], [13.143262662643165, 46.60063779191215], [13.13496131760883, 46.63692453482463], [13.069743861309572, 46.93163081332146], [13.070006129296766, 46.93612800342123], [13.075566308573105, 46.941375462015834], [13.294119494497687, 47.033142612491254], [13.574764034389897, 46.999003944265816], [13.879553340060356, 46.93982939568926], [13.929799185254298, 46.926296165265505], [13.972723397919705, 46.903093462745254], [13.953227913224316, 46.85333317121097], [13.921631911204708, 46.81662925415459], [13.74829840601839, 46.70201862120477], [13.741455995845904, 46.69775001911813], [13.734741413936037, 46.69527923721076], [13.732068421014143, 46.69447063268202], [13.213451896645154, 46.57423093161292], [13.191260125971837, 46.57399126631647]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;6&quot;, &quot;properties&quot;: {&quot;labels&quot;: 61019}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [13.336514728143337, 47.50658805562282, 13.893771666605046, 47.81589527145653], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[13.673512356211283, 47.50658805562282], [13.589692935596373, 47.523793891222674], [13.336514728143337, 47.676850332773135], [13.339770418344731, 47.70647410468489], [13.35761634502628, 47.73475020096459], [13.38788601410518, 47.768944702562365], [13.398840993012437, 47.773108740731836], [13.747703428013626, 47.814875498210604], [13.770498172283165, 47.81589527145653], [13.775830608851594, 47.815711670854], [13.795494012470481, 47.81052806429668], [13.801691981576132, 47.80400710760722], [13.893771666605046, 47.64400755939758], [13.874741893505366, 47.621258526277394], [13.825386186066709, 47.56623693916191], [13.82120667923547, 47.56368041288024], [13.769759595643121, 47.53303499312681], [13.75313147706697, 47.52369779160692], [13.717566334657327, 47.50959969261286], [13.70279526302597, 47.50739944631164], [13.673512356211283, 47.50658805562282]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;7&quot;, &quot;properties&quot;: {&quot;labels&quot;: 61071}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [13.227230600345495, 46.53233162295875, 13.804518760994567, 46.8184789575062], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[13.648981702345992, 46.532375852915926], [13.233303328411415, 46.55741417829144], [13.229616229890002, 46.561129814678374], [13.227230600345495, 46.56480621063573], [13.227830668772866, 46.57470104636657], [13.249523170309896, 46.63082032764409], [13.412988127583143, 46.8168046509948], [13.417028621747765, 46.8184789575062], [13.4196447910887, 46.818396031794215], [13.478388176157111, 46.81471494376719], [13.59407760705379, 46.781180671550885], [13.793732294608024, 46.6787939439645], [13.797194794606161, 46.67236217461821], [13.804518760994567, 46.64686460831631], [13.797357495734033, 46.63810383074626], [13.66093705825474, 46.53557430005], [13.650282613879549, 46.53233162295875], [13.648981702345992, 46.532375852915926]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;8&quot;, &quot;properties&quot;: {&quot;labels&quot;: 62171}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [13.535682790854345, 47.226143253805326, 14.354063555313552, 47.69507098854227], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[14.270888802630433, 47.226143253805326], [14.21430068940556, 47.22925696282496], [14.084112186874469, 47.23783926047597], [13.972477871347381, 47.24738921941744], [13.609947343990582, 47.280770111339905], [13.535682790854345, 47.375108878628744], [13.548346509009642, 47.44406723625023], [13.583534977135082, 47.49246522439591], [13.900891112151154, 47.65006054455095], [14.099011549409976, 47.69507098854227], [14.134899313936808, 47.660379230871065], [14.334609815814227, 47.37234257046886], [14.353304674631186, 47.32652801396031], [14.354063555313552, 47.303963279276665], [14.35301091789976, 47.291386132464396], [14.314613666156726, 47.24334260041664], [14.276306742069227, 47.22773261534926], [14.270888802630433, 47.226143253805326]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;9&quot;, &quot;properties&quot;: {&quot;labels&quot;: 62749}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [13.278785983041237, 46.92824103864724, 14.359853844953369, 47.286179209977604], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[13.933931975794943, 46.928849683331435], [13.472692786612887, 46.96718759187378], [13.470128652409619, 46.96817101692051], [13.28023306357812, 47.042574068922775], [13.278785983041237, 47.06153804242156], [13.295913320974856, 47.082640963272986], [13.434706997837884, 47.17022933080561], [13.60606334027311, 47.26287901068793], [13.769055240338668, 47.286179209977604], [14.234793096255785, 47.25369672245085], [14.283127758820983, 47.24639232844219], [14.309044298895667, 47.23995832248784], [14.347083228161901, 47.22041328023337], [14.355704824263329, 47.21285616724437], [14.35796393533695, 47.208258332513694], [14.358980736699598, 47.20461178299648], [14.359853844953369, 47.16761791873284], [14.35977884228409, 47.166719493230914], [14.248868340778321, 47.02058722983675], [14.179207664205869, 46.989047531819175], [14.10183591198603, 46.958659498351345], [14.03717603215445, 46.93856045785647], [13.99958915134514, 46.92824103864724], [13.933931975794943, 46.928849683331435]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;10&quot;, &quot;properties&quot;: {&quot;labels&quot;: 62764}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [13.627662143909994, 46.38435024733196, 14.690789603509712, 47.02425306047654], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[14.570264503125253, 46.38435024733196], [14.16595167638928, 46.43871494524599], [13.663044267057296, 46.52829137186222], [13.631259199079699, 46.54018773625199], [13.627662143909994, 46.54481613544096], [13.740842314532994, 46.744640241651325], [13.996695269127994, 46.924742742133176], [13.998073871031789, 46.92559307331199], [14.203970323397844, 47.00251031504515], [14.25535795434988, 47.01943064222981], [14.270233837034285, 47.02425306047654], [14.288315902994617, 47.01993178841668], [14.290867321136087, 47.01892912335258], [14.2921062390812, 47.017978491455864], [14.416936209269249, 46.92099236515274], [14.678397484746625, 46.48971941833258], [14.690789603509712, 46.46753103188116], [14.570264503125253, 46.38435024733196]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;11&quot;, &quot;properties&quot;: {&quot;labels&quot;: 65198}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [14.099808056709342, 47.296564730867026, 14.80666735656861, 47.753050064265246], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[14.35873937203028, 47.296564730867026], [14.187123116604681, 47.532228357245806], [14.099808056709342, 47.67161313842256], [14.152856943110196, 47.75070907117441], [14.158327052652258, 47.75230354543249], [14.162393420181148, 47.753050064265246], [14.300672708995704, 47.74590146873423], [14.334971313676533, 47.74094344655437], [14.432507407856981, 47.72622085207576], [14.49408360404703, 47.712893006443686], [14.572511778997027, 47.694319204740516], [14.704964817626813, 47.65444446623928], [14.775926409714176, 47.62882803387314], [14.788783128827053, 47.623757464776865], [14.80666735656861, 47.58691074273119], [14.73281831963527, 47.420653224233696], [14.649179709524722, 47.3909023512567], [14.35873937203028, 47.296564730867026]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;12&quot;, &quot;properties&quot;: {&quot;labels&quot;: 68882}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [14.414854216673687, 46.483704015936475, 15.073729077471366, 47.065176725427364], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[14.692212648461611, 46.483704015936475], [14.542832779814736, 46.55146276468805], [14.529443015296236, 46.56285050699489], [14.48150457843529, 46.691108922120975], [14.433877783382524, 46.825628097010565], [14.414854216673687, 46.88050576898176], [14.415098562408076, 46.9147564163522], [14.42225127132061, 46.92167639966237], [14.702941527274183, 47.04687649897154], [14.755034399049666, 47.05451821549598], [14.860163396220218, 47.065176725427364], [15.002095721396579, 46.99106558932231], [15.073729077471366, 46.914665890135296], [15.02838590025212, 46.68767622715566], [15.016227279787145, 46.64223845501187], [14.994068205190528, 46.61530622933743], [14.983858904633554, 46.60405339710013], [14.789853243345375, 46.51095636276196], [14.692212648461611, 46.483704015936475]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;13&quot;, &quot;properties&quot;: {&quot;labels&quot;: 73704}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [14.249293731191145, 46.92446380696466, 15.01562469054842, 47.399560675721055], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[14.440893031723256, 46.92451768954455], [14.430488954710357, 46.925846666039774], [14.42015986669531, 46.92807313781568], [14.33314283498761, 46.956842494505594], [14.322157920839132, 46.967199147002205], [14.273591091333515, 47.03313502367111], [14.251124577009262, 47.06466899831543], [14.249293731191145, 47.15578286282646], [14.251121398919606, 47.16202089043966], [14.264290671931423, 47.19395345027289], [14.35556845421652, 47.32193046504375], [14.388430806834275, 47.350354101827385], [14.685589185540975, 47.397453989122354], [14.720277447859466, 47.399560675721055], [14.939615937699774, 47.3339159596719], [14.942084609828326, 47.332000269741656], [14.970204038528479, 47.30727231016388], [14.977344666528712, 47.298829507339924], [15.011652916275214, 47.228715063894604], [15.01562469054842, 47.21500422468178], [15.000648718688717, 47.196757652546815], [14.87594523071487, 47.078895391404124], [14.858933630024815, 47.066133742772855], [14.521568116334056, 46.93018592000186], [14.51748368399668, 46.928553584665515], [14.442202988911061, 46.92446380696466], [14.440893031723256, 46.92451768954455]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;14&quot;, &quot;properties&quot;: {&quot;labels&quot;: 73741}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [14.714894412381689, 47.2360639994966, 15.807922086796559, 47.77549399762794], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[15.028237209583015, 47.2360639994966], [14.945169870852862, 47.26693470413668], [14.749193883980281, 47.38207385528613], [14.714894412381689, 47.41331731173141], [14.796830566178059, 47.62430573712353], [14.79824155785739, 47.62514525119037], [14.809363396086784, 47.63006504416719], [15.004905099790992, 47.69430885422294], [15.421457262619604, 47.77003642624503], [15.456812417864809, 47.77549399762794], [15.646923911683267, 47.69187862225353], [15.743467333587482, 47.63542336688809], [15.770941458691738, 47.61863708812224], [15.774617946181282, 47.615736018541256], [15.797905571528768, 47.58563018792463], [15.798927885694813, 47.5828691671077], [15.80495863266945, 47.56540592792881], [15.807922086796559, 47.55622571241529], [15.80771997244579, 47.55443199986997], [15.806294456743313, 47.55360570207573], [15.364550240526624, 47.302037341561686], [15.028237209583015, 47.2360639994966]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;15&quot;, &quot;properties&quot;: {&quot;labels&quot;: 76353}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [14.991804367615531, 47.68160339567546, 15.532611627117888, 48.30092184787007], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[15.026354420190975, 47.68160339567546], [15.012265402871277, 47.68766024331078], [15.003209121852276, 47.70430421848457], [14.991804367615531, 47.87522183232335], [15.087651889630006, 48.244949945920354], [15.095741656251239, 48.271620317150024], [15.104367723386087, 48.290152261873935], [15.163552315771103, 48.30092184787007], [15.285336104098578, 48.28974866772902], [15.301089014399645, 48.285386802103694], [15.493065852965248, 48.22459777190714], [15.494310539692657, 48.223633988652225], [15.52708394965101, 48.17780805062465], [15.532611627117888, 48.166708933482546], [15.532317429999322, 48.16401830444534], [15.424117820444279, 47.782530743177354], [15.418130212629116, 47.776514296595664], [15.344388251965587, 47.71069995875512], [15.120420347431107, 47.68805642224665], [15.026354420190975, 47.68160339567546]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;16&quot;, &quot;properties&quot;: {&quot;labels&quot;: 77565}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [14.870751580554428, 46.61447550730306, 16.484625509324992, 47.55454200032321], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[15.466169573947653, 46.61487323122649], [15.026025586091029, 46.64899732946467], [14.871730489558631, 47.06195115056336], [14.870751580554428, 47.06560240136419], [14.871002189483335, 47.06829649935916], [14.901889846408954, 47.1165007282494], [14.90642275525566, 47.122607988697425], [15.142978389010896, 47.29922815510566], [15.532244566399724, 47.457805945584624], [15.692093837249644, 47.52083572390148], [15.782973086101133, 47.547627673924396], [15.800693780435594, 47.55119718299023], [15.83156019465149, 47.55315916153227], [15.873024561153013, 47.55454200032321], [16.04962434747889, 47.53766273167328], [16.38325326483532, 47.41209979941845], [16.385119396713904, 47.40567088027002], [16.484625509324992, 46.9997817726857], [16.484181739886708, 46.99619636755523], [16.036381366898322, 46.66918782188138], [15.473977859002435, 46.61447550730306], [15.466169573947653, 46.61487323122649]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;17&quot;, &quot;properties&quot;: {&quot;labels&quot;: 77791}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [15.141505080127539, 48.2202697914365, 16.03139757658701, 48.85622188447528], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[15.388745772011843, 48.220729492388166], [15.33271386109953, 48.25230641531854], [15.271863096564777, 48.30301498268508], [15.243831477090666, 48.332297800290696], [15.229457235320355, 48.35010822771901], [15.183807494564107, 48.418968603726654], [15.166267839896948, 48.44593112927424], [15.163940173494508, 48.44964552772981], [15.161704487171358, 48.45425700585466], [15.141505080127539, 48.50838052005848], [15.148356410978131, 48.548625422519805], [15.157425438240901, 48.57073882086087], [15.237008985285334, 48.7337722549289], [15.250605051917558, 48.75927174514034], [15.277600260184943, 48.78233249522331], [15.279053066880328, 48.78316500076185], [15.446711374637488, 48.85622188447528], [15.458944739582185, 48.85562318707316], [15.643112402963677, 48.780624698157325], [15.736767667711417, 48.74066638399761], [15.932364676326298, 48.65373616628364], [15.941409586461733, 48.649644602753064], [16.03139757658701, 48.594276954688326], [16.02841979817807, 48.558357045228824], [16.02831166694573, 48.5574608755266], [16.01729849793278, 48.51115279752598], [15.970255406041852, 48.32156212256243], [15.830104507987624, 48.291169603891696], [15.483767379633763, 48.225962461772674], [15.456339354707616, 48.22191304303852], [15.398141541297472, 48.2202697914365], [15.388745772011843, 48.220729492388166]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;18&quot;, &quot;properties&quot;: {&quot;labels&quot;: 80132}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [15.364083939869625, 47.789878490299216, 15.910178709360293, 48.33233485094199], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[15.439613872211535, 47.789878490299216], [15.364083939869625, 48.013639956870556], [15.36484125295778, 48.02081686401501], [15.371516609235309, 48.033115034377545], [15.499534339696527, 48.24681909966263], [15.512236068251555, 48.264220047316876], [15.521277358316075, 48.272785451620194], [15.540121938493412, 48.28446549001864], [15.650758397274867, 48.33116159150216], [15.663064166594799, 48.33233485094199], [15.726698445472355, 48.320935869961666], [15.757838750229077, 48.309394984928176], [15.805815177207807, 48.291548371141296], [15.825244447008567, 48.28421044706034], [15.909995981688786, 48.00366028348171], [15.910178709360293, 47.92426007226426], [15.910074723264154, 47.92336349848743], [15.898943245689965, 47.88516926985722], [15.88497082986171, 47.857050771061374], [15.855143573656743, 47.842410187596194], [15.834141573164926, 47.83450949222923], [15.439613872211535, 47.789878490299216]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;19&quot;, &quot;properties&quot;: {&quot;labels&quot;: 81675}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [15.685468228604861, 47.913389232897515, 16.801815192368554, 48.66398356787587], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[16.56138360329309, 47.913389232897515], [16.279403142027817, 47.93531979363297], [15.85666442967426, 48.01914712445136], [15.735864295505538, 48.08054314111374], [15.712938699421592, 48.11601119236415], [15.685468228604861, 48.18327448393001], [15.686275008877756, 48.190448118844934], [15.749099083781783, 48.26836213463846], [16.047132531390655, 48.60063639246553], [16.048592813531148, 48.60145880857374], [16.057137927708244, 48.60460065120524], [16.094837901464864, 48.61245813067579], [16.41319737101255, 48.66398356787587], [16.473142101855935, 48.65328425325524], [16.51936848550955, 48.63162660554183], [16.605683320969753, 48.56334223713024], [16.61247821789018, 48.55300883843102], [16.788525034480614, 48.1659015680606], [16.801815192368554, 48.0639601113996], [16.782777448372066, 47.982072537111804], [16.766595527125627, 47.951470970284184], [16.76309495958646, 47.94536674254562], [16.722649792794783, 47.93431137063311], [16.56138360329309, 47.913389232897515]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;20&quot;, &quot;properties&quot;: {&quot;labels&quot;: 84568}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [15.466040492962263, 47.56021554059652, 16.501020495189124, 48.07750334981241], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[15.817699892937862, 47.56021554059652], [15.512553872911198, 47.746543637525335], [15.472491221975726, 47.77200525750471], [15.466040492962263, 47.78675808524469], [15.851427820079238, 48.032055551624396], [16.04516017524915, 48.07750334981241], [16.111652718777528, 48.059389946503565], [16.45664630981407, 47.924122460649926], [16.501020495189124, 47.90344636636912], [16.308046734716584, 47.678255792097396], [16.286723003140377, 47.6569211518353], [16.277996719087874, 47.65110536490034], [16.276560788199802, 47.65028537538281], [16.266838572348885, 47.64723377357989], [16.25855297860447, 47.64500154218992], [15.817699892937862, 47.56021554059652]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;21&quot;, &quot;properties&quot;: {&quot;labels&quot;: 85345}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [15.826858318532826, 47.397880000057455, 16.54942449850357, 47.68913213968008], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[16.394793481238548, 47.397880000057455], [16.17094034205292, 47.43789559181087], [15.952728651771178, 47.51773303936435], [15.842765459967644, 47.55797269560357], [15.829001142077345, 47.57765686761855], [15.826858318532826, 47.58228261948051], [15.857850369344565, 47.620321700031035], [16.127532003430037, 47.68853375591239], [16.132949327157316, 47.68913213968008], [16.134276888340437, 47.68905758681969], [16.227545858316834, 47.67565630076463], [16.23141834180123, 47.67453283890807], [16.25188690292043, 47.667044910402254], [16.538601518826944, 47.441689980030226], [16.54942449850357, 47.42207798720339], [16.539163006365257, 47.41456969718601], [16.49730846948439, 47.3990222366976], [16.394793481238548, 47.397880000057455]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;22&quot;, &quot;properties&quot;: {&quot;labels&quot;: 86878}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [16.02947539323192, 46.98064539062714, 16.51850458204819, 47.39852038828883], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[16.258065833735234, 46.98064539062714], [16.17127026195971, 46.993765962764826], [16.1562879405438, 47.00094027507989], [16.02947539323192, 47.11369937022564], [16.02978599525177, 47.116389844423445], [16.05129864444698, 47.176565652147204], [16.05628444375907, 47.18531287439907], [16.07745639013844, 47.219328408570746], [16.194841850330064, 47.35981521991832], [16.39148982218994, 47.39265769972641], [16.42393977807163, 47.39706393573633], [16.49059744534364, 47.39852038828883], [16.51850458204819, 47.134096963835525], [16.50529363983508, 47.05994382482859], [16.480828222173372, 47.011748836709934], [16.479296394656604, 47.0100347366318], [16.258065833735234, 46.98064539062714]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;23&quot;, &quot;properties&quot;: {&quot;labels&quot;: 89293}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [16.268164896717494, 47.41721923, 17.005236339377714, 47.9378966078843], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[16.57009246222198, 47.41721923], [16.56107910910237, 47.419569427315466], [16.48956544340021, 47.464489360951944], [16.47845966079923, 47.47147095630566], [16.295392771127624, 47.596849792791495], [16.29296201283247, 47.59879531883499], [16.272512071680982, 47.61712270040336], [16.269300396506246, 47.62362540468018], [16.268164896717494, 47.64715760526102], [16.271519237275722, 47.70743654605295], [16.271628855536637, 47.70833280328806], [16.301799702723866, 47.779704053950255], [16.30778139312323, 47.78477454781008], [16.350238641008904, 47.813908145280045], [16.512180915942405, 47.91722653943127], [16.517742124130972, 47.918701334607405], [16.670536141176257, 47.93659206170994], [16.708338927694264, 47.9378966078843], [16.768808759068598, 47.93779097050208], [16.944865943035307, 47.79944219677018], [16.955123936919847, 47.786146626635976], [17.005236339377714, 47.711595943852494], [16.66166132488165, 47.4567952532325], [16.57571455525723, 47.419588045241895], [16.57009246222198, 47.41721923]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;24&quot;, &quot;properties&quot;: {&quot;labels&quot;: 91199}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [16.48829597377747, 48.18666118582615, 16.86851601390155, 48.54993197943776], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[16.779236110480706, 48.18723915205803], [16.7753371246403, 48.1883820276743], [16.675718166776946, 48.22154964519111], [16.63079099259482, 48.23960873615185], [16.55146011203953, 48.294898939343376], [16.546671080741753, 48.29969618492492], [16.48829597377747, 48.37173612490381], [16.622325327432105, 48.54520005600643], [16.6487980453282, 48.54993197943776], [16.67237094595064, 48.543098692927586], [16.73921049375547, 48.483987781974506], [16.86644470711169, 48.35157302108918], [16.86851601390155, 48.327067199136486], [16.79153413325607, 48.18828670464529], [16.788613937571053, 48.18666118582615], [16.779236110480706, 48.18723915205803]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;25&quot;, &quot;properties&quot;: {&quot;labels&quot;: 93688}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [16.731597438287903, 47.706215600202356, 17.43484717056804, 48.32231392500239], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[17.060721201638753, 47.706215600202356], [17.012239094060828, 47.7138560569437], [17.005011221004107, 47.719739100875636], [16.890718860337742, 47.82544356722978], [16.78456798880666, 47.93501090805305], [16.731597438287903, 48.022241322325286], [16.81608295724632, 48.24003702996692], [16.831914129568474, 48.26704457683188], [16.861798836493627, 48.317553851619834], [16.886830971514563, 48.32231392500239], [17.27536844909302, 48.244975581070584], [17.278872927481206, 48.24113095240767], [17.43484717056804, 48.068992035690705], [17.413666501696195, 47.961103486282525], [17.08364778463709, 47.7074402890173], [17.076889997197625, 47.7069752644874], [17.060721201638753, 47.706215600202356]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;26&quot;, &quot;properties&quot;: {&quot;labels&quot;: 97783}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_ce10b91d42aff75c5c193b17524c9fb1.bindTooltip(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;labels&quot;];
    let aliases = [&quot;labels&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i]}</th>
            
            <td>${handleObject(layer.feature.properties[v])}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
            geo_json_ce10b91d42aff75c5c193b17524c9fb1.addTo(map_3f28325b95dbc0a1fa3b3088ffb3eb82);
        
</script>
</html>" style="position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen=""></iframe></div></div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>